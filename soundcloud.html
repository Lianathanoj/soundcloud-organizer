<!DOCTYPE HTML>
<html>
<head>
    <script src="https://connect.soundcloud.com/sdk/sdk-3.1.2.js"></script>
    <script src="https://code.jquery.com/jquery-3.1.0.js"   integrity="sha256-slogkvB1K3VOkzAI8QITxV3VzpOnkeNVsKvtkYLMjfk="   crossorigin="anonymous"></script>
    <script>
    SC.initialize({
      client_id: 'e8f229ff62df70ca77ff05cf6f458d83',
      redirect_uri: 'file:///C:/Users/Jonathan/Documents/GitHub/soundcloud-organizer/callback.html' // USE THIS FOR LOCAL TESTING OF OAUTH
    });

    // oauth probably not even necessary
    // initiate auth popup
    // SC.connect().then(function() {
      // return SC.get('/me');
    // }).then(function(me) {
      // alert('Hello, ' + me.username);
    // });
    
    var favorites = $("<br><input id='favorites' type='button' value='Sort by most favorites'>");
    var songCount = 0;
    var artist;
    
    $(document).ready(function() {
        $("#find").click(function() {
            artist = $("#artist").val();
            $("form").append(favorites);
            SC.get("/resolve/?url=https://soundcloud.com/" + artist + "/tracks").then(function(tracks) {
                if (tracks.length < songCount) {
                    songCount = tracks.length;
                }
                for (var i = songCount; i < songCount + 5; i++) { // TODO: make client-side loading sequential & interruptable by buttons
                    SC.oEmbed(tracks[i].permalink_url, {maxheight: 200}).then(function(widget) {
                        $("table").append("<tr><td>" + widget.html + "</td></tr>");
                    });
                }
                songCount += 5; // TODO: add button at bottom to load more songs
            }); // gets JSON track data; EDIT: due to nature of asynchronous
            // you can't just put JSON data from SC.get into variable outside of callback function, so use callback function instead
        });

        favorites.click(function() { // try out .on later and replace favorites variable
            $("table").children("tr").remove();
            songCount = 0;
            SC.get("/resolve/?url=https://soundcloud.com/" + artist + "/tracks").then(function(tracks) {
                tracks.sort(function (x, y) {
                    return y.favoritings_count - x.favoritings_count;
                });
                console.log(tracks);
                if (tracks.length < songCount) {
                    songCount = tracks.length;
                }
                for (var i = songCount; i < songCount + 5; i++) {
                    SC.oEmbed(tracks[i].permalink_url, {maxheight: 200}).then(function(widget) { // TODO: make as a separate function and call it
                        $("table").append("<tr><td>" + widget.html + "</td></tr>");
                    });
                }
            });
        });
    });
    
    // TODO: playlist compatability??
    
  
  
    </script>
</head>

<body>
    <form>
        Find an artist:<br>
        <input id="artist" type="text" name="artist" required>
        <input id="find" type="button" value="Submit">
    </form>
    <table></table>
</body> 
</html>
